# 🏊‍♂️ 游泳游戏 - 基于手机传感器的互动游戏

## 项目简介

这是一个基于手机方向传感器的游泳小游戏。玩家通过“倾斜手机”来控制角色方向，持续前进、收集金币并躲避障碍物。游戏集成了方向传感器（DeviceOrientation），并提供调试摇杆与调试轮盘以便在 H5 环境下验证与演示。

## 🎮 游戏特性

### 核心功能
- **方向控制**：基于手机方向（gamma/beta）的倾斜控制，配合虚拟摇杆可在 H5 调试
- **游戏机制**：60 秒挑战，金币计分，生命系统，后期难度逐步增加
- **生命与无敌**：初始 3 条命，撞击扣 1 命并短暂无敌，心形 UI 展示生命（含空心上限）
- **连吃奖励**：连续吃 3 个金币 +1 命（上限 5）
- **数据持久化**：记录最佳分数、最近分数、累计局数/金币、最长一局用时

### 技术特性
- ⚡ 实时传感器数据处理
- 🔧 跨平台兼容性处理
- 🛡️ 权限管理和错误处理
- 📊 性能优化和内存管理

## 📱 兼容性

| 平台 | 支持状态 | 说明 |
|------|----------|------|
| iOS Safari | ✅ 完全支持 | 需要 HTTPS 与用户手势授权 |
| Android Chrome | ✅ 完全支持 | 需要 HTTPS 与用户手势授权 |
| 其他浏览器 | ⚠️ 部分支持 | 取决于方向传感器 API 支持 |

## 🚀 快速开始

### 1. 访问游戏
```
/pages/swimming/demo  - 游戏演示页面
/pages/swimming/index - 游戏主页面
```

### 2. 权限设置
- 确保设备支持传感器功能
- 授权传感器权限（现代浏览器需要）
- 使用HTTPS协议访问（推荐）

### 3. 开始游戏
1. 倾斜手机控制方向（左右/前后）
2. 角色持续前进，方向受倾斜与摇杆影响
3. 收集金币 +1 分，避开障碍物；初始 3 命、撞击扣命并短暂无敌
4. 每连续吃 3 个金币 +1 命（上限 5），倒计时 60 秒

## 🎯 游戏规则

### 计分与生命
- 金币：+1 分
- 连吃 3 金币：+1 命（上限 5）
- 撞击：扣 1 命并获得短暂无敌（默认 1.2s）
- 生命 UI：❤️ 表示当前生命，🤍 表示上限未获得

## 🛠️ 技术实现

### 文件结构
```
├── common/
│   ├── sensorManager.js      # 传感器管理器
│   ├── swimmingGame.js       # 游戏逻辑类
│   └── sensorUtils.js        # 传感器工具类
├── components/
│   └── SwimmingGameUI.vue    # 游戏界面组件
├── pages/swimming/
│   └── index.vue             # 游戏主页面
└── static/
  └── swimming-game.css     # 游戏样式
```

### 核心类说明

#### SensorManager (传感器管理器)
- 处理方向/运动传感器数据
- 权限请求与错误处理

#### SwimmingGame (游戏逻辑)
- 游戏状态/时间循环（performance.now）
- 倾斜/摇杆输入平滑（lerp）与自动前进行为
- 基于百分比坐标的命中半径碰撞（更贴合视觉）
- 基于时间的生成调度（全程生成，后期更密集）
- 分数、生命、无敌、连吃奖励、结束原因（time/lives）

#### SwimmingGameUI (游戏界面)
- 响应式界面设计
- 动画效果
- 用户交互

## 🔧 开发说明

### 环境要求
- uni-app框架
- 支持传感器的移动设备
- 现代浏览器（支持传感器API）

### 传感器API
```javascript
// 方向传感器
window.addEventListener('deviceorientation', handleOrientation);

// 权限请求（现代浏览器，需要在用户手势下发起）
if (DeviceOrientationEvent.requestPermission) {
  const r = await DeviceOrientationEvent.requestPermission();
  if (r !== 'granted') throw new Error('方向传感器权限被拒绝');
}
```

### 倾斜映射示例
```javascript
// gamma: 左右 (-90..90) → x 方向；beta: 前后 (-180..180) → y 方向
const tiltX = (orientation.gamma || 0) / 90;
const cappedBeta = Math.max(-90, Math.min(90, orientation.beta || 0));
const tiltY = cappedBeta / 90;
game.setTilt(tiltX, tiltY); // -1..1
```

## 🎨 界面设计

### 设计原则
- **简洁明了**：清晰的游戏界面
- **响应式**：适配不同屏幕尺寸
- **流畅动画**：提升用户体验
- **直观操作**：易于理解的交互

### 视觉元素
- 🌊 水波背景
- 🏊‍♂️ 游泳角色
- 🪨 障碍物
- 🪙 金币收集粒子
- ✨ 撞击/加命粒子

## 🔒 安全考虑

### 权限管理
- 明确的权限请求流程
- 权限被拒绝时的友好提示
- 降级处理方案

### 错误处理
- 传感器不可用时的提示
- 网络错误的处理
- 游戏异常的恢复

## 📈 性能优化

### 传感器数据处理
- 低频 UI 同步（~30fps），减少渲染压力
- 倾斜输入与虚拟摇杆输入融合

### 游戏性能
- 对象池减少分配
- RAF 驱动、性能时间源
- 时间调度生成（稳定产出）

## 🐛 故障排除

### 常见问题

#### 传感器不可用
- 检查设备是否支持传感器
- 确认浏览器支持传感器API
- 使用HTTPS协议访问

#### 权限被拒绝
- 检查浏览器权限设置
- 重新授权传感器权限
- 尝试不同的浏览器

#### 游戏卡顿
- 关闭其他应用释放内存
- 检查网络连接
- 刷新页面重试

## 📝 更新日志

### v1.1.0 (2025-11-19)
- 🚗 控制改为倾斜/摇杆，移除挥臂速度逻辑
- ❤️ 生命系统：无敌与连吃奖励；心形 UI 展示
- 🧠 碰撞半径基于百分比坐标，手感更贴近视觉
- ⏱️ 基于时间的生成与难度渐进
- 🧾 成绩与统计持久化（最佳/最近/累计/最长）

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

本项目采用MIT许可证，详情请查看LICENSE文件。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件
- 项目讨论区

---

**享受游泳游戏的乐趣！🏊‍♂️✨**
